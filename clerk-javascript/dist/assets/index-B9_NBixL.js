(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();let m=[],l=[],E=null,I=0,p={account_name:"",account_number:"",instructions:""},C=[],S="",f={front_page:{color:"",image:""},shop:{color:"",image:""}},L=null;const ie="pk_test_ZGl2ZXJzZS1pbnNlY3QtOTAuY2xlcmsuYWNjb3VudHMuZGV2JA";let G=!1,x=null,v=null,h=null,A=!1;async function g(e,t={}){const n={credentials:"include",...t};n.headers={"Content-Type":"application/json",...t.headers||{}};const o=await fetch(e,n),r=(o.headers.get("content-type")||"").includes("application/json")?await o.json().catch(()=>null):null;if(!o.ok){const s=new Error(r&&r.error||"Request failed");throw s.status=o.status,s.data=r,s}return r}function re(e){return e?e.primaryEmailAddress&&e.primaryEmailAddress.emailAddress?e.primaryEmailAddress.emailAddress:Array.isArray(e.emailAddresses)&&e.emailAddresses.length>0&&e.emailAddresses[0].emailAddress||"":""}function _(){const e=document.getElementById("front-signout-btn");e&&(e.style.display=L?"inline-block":"none");const t=document.getElementById("front-signin-btn");t&&(t.style.display=L?"none":"inline-block")}function F(){if(!window.Clerk)return;const e=window.Clerk.user||null;L=e?{email:re(e)||e.id}:null,L||(h=null),_()}function ce(){return window.Clerk?Promise.resolve():x||(x=new Promise((e,t)=>{const n=document.createElement("script");n.async=!0,n.crossOrigin="anonymous",n.src="https://js.clerk.com/npm/clerk.browser.js",n.onload=()=>e(),n.onerror=()=>t(new Error("Clerk script failed to load.")),document.head.appendChild(n)}),x)}async function Q(){if(!G)try{if(await ce(),!window.Clerk)throw new Error("Clerk script not loaded.");await window.Clerk.load({publishableKey:ie}),F(),typeof window.Clerk.addListener=="function"&&window.Clerk.addListener(F),G=!0,v=null}catch(e){throw v=e,console.error("Clerk init failed:",e),e}}async function de(e){try{await Q()}catch{const n=v&&v.message?v.message:"Sign in is still loading.";alert(n+" If this keeps happening, add your site URL to Clerk Application domains.");return}if(!window.Clerk){alert("Sign in is still loading. Please try again.");return}e==="signin"?window.Clerk.openSignIn():window.Clerk.openSignUp()}async function se(){window.Clerk&&await window.Clerk.signOut(),L=null,h=null,T(),_()}async function le(){F()}function T(){const e=!!h,t=document.getElementById("admin-panel-btn");t&&(t.style.display=e?"inline-block":"none"),document.getElementById("add-product-section").style.display=e?"block":"none";const n=document.getElementById("background-section");n&&(n.style.display=e?"block":"none");const o=document.getElementById("front-bg-btn"),a=document.getElementById("shop-bg-btn");o&&(o.style.display=e?"inline-block":"none"),a&&(a.style.display=e?"inline-block":"none");const i=document.getElementById("bank-info-section");i&&(i.style.display=y()?"block":"none");const r=document.getElementById("orders-section");r&&(r.style.display=y()?"block":"none"),_()}function y(){return h&&h.is_owner}function B(){return!!h}function me(){document.getElementById("admin-login-modal").style.display="flex",document.getElementById("admin-email-input").value="",document.getElementById("admin-password-input").value="",document.getElementById("admin-login-error").textContent="",J()}function H(){document.getElementById("admin-login-modal").style.display="none",document.getElementById("admin-password-input").value="",document.getElementById("admin-email-input").value="",document.getElementById("admin-login-error").textContent=""}async function ue(){const e=document.getElementById("admin-email-input").value.trim().toLowerCase(),t=document.getElementById("admin-password-input").value,n=document.getElementById("admin-login-error");if(n.textContent="",!e||!t){n.textContent="Email and password are required.";return}try{h=await g("/api/sessions",{method:"POST",body:JSON.stringify({email:e,password:t})}),await N(),T(),w(),M(),y()&&await b(),H()}catch(o){n.textContent=o.data&&o.data.error||"Login failed."}}async function ge(){try{await g("/api/sessions",{method:"DELETE"})}catch{}h=null,T(),R(),w(),M(),C=[],D()}async function pe(){const e=document.getElementById("bootstrap-email").value.trim().toLowerCase(),t=document.getElementById("bootstrap-password").value,n=document.getElementById("admin-login-error");if(n.textContent="",!e||!t){n.textContent="Owner email and password are required.";return}try{await g("/api/admins/bootstrap",{method:"POST",body:JSON.stringify({email:e,password:t})}),A=!1,n.textContent="Owner created. Please log in.",document.getElementById("bootstrap-email").value="",document.getElementById("bootstrap-password").value="",J()}catch(o){n.textContent=o.data&&o.data.error||"Could not create owner."}}async function fe(){if(!h){alert("You must be logged in as admin to access this panel.");return}document.getElementById("current-admin-email").textContent=h.email,await N();const e=document.querySelector(".admin-list-section");e&&(e.style.display=y()?"block":"none"),document.getElementById("admin-panel-modal").style.display="flex",document.getElementById("new-admin-email").value="",document.getElementById("new-admin-password").value="",z(),y()&&await b()}function R(){document.getElementById("admin-panel-modal").style.display="none"}async function ye(){if(!y()){alert("Only the owner can add new admins.");return}const e=document.getElementById("new-admin-email").value.trim().toLowerCase(),t=document.getElementById("new-admin-password").value;if(!e||!t){alert("Please enter email and password.");return}try{await g("/api/admins",{method:"POST",body:JSON.stringify({email:e,password:t})}),document.getElementById("new-admin-email").value="",document.getElementById("new-admin-password").value="",await N(),alert("Admin added successfully!")}catch(n){alert(n.data&&n.data.error||"Could not add admin.")}}async function he(e){if(!y()){alert("Only the owner can remove admins.");return}if(confirm("Remove admin access?"))try{await g(`/api/admins/${e}`,{method:"DELETE"}),await N()}catch(t){alert(t.data&&t.data.error||"Could not remove admin.")}}async function N(){const e=document.getElementById("admin-list");if(e.innerHTML="",!y()){e.innerHTML="<li>Only the owner can manage admins.</li>";return}try{(await g("/api/admins")).forEach(n=>{const o=document.createElement("li");o.className="admin-list-item",o.innerHTML=`
                <span>${n.email}</span>
                ${n.is_owner?'<span class="owner-badge">Owner</span>':""}
                ${n.is_owner?"":`<button onclick="removeAdmin(${n.id})" class="remove-admin-btn">Remove</button>`}
            `,e.appendChild(o)})}catch{e.innerHTML="<li>Could not load admins.</li>"}}async function we(){try{A=!(await g("/api/admins/has-admin")).hasAdmin}catch{A=!1}J()}function J(){const e=document.getElementById("bootstrap-section");e&&(e.style.display=A?"block":"none")}async function W(){await we();try{h=await g("/api/session")}catch{h=null}T(),w(),M(),y()&&await b()}function Ee(){const e=localStorage.getItem("products");e?m=JSON.parse(e):m=[]}function O(){localStorage.setItem("products",JSON.stringify(m))}function Ie(){const e=localStorage.getItem("cart");e?l=JSON.parse(e):l=[]}function j(){localStorage.setItem("cart",JSON.stringify(l))}function Be(e){l.push(m[e]),j(),$()}function be(e){l.splice(e,1),j(),$()}function $(){const e=document.getElementById("cart-count");l.length>0?(e.textContent=l.length,e.style.display="inline-block"):(e.textContent="",e.style.display="none");const t=document.getElementById("cart-list");if(!t)return;t.innerHTML="",l.length===0?t.innerHTML="<li>Cart is empty!</li>":l.forEach((a,i)=>{const r=document.createElement("li");if(a.images&&a.images[0]){const c=document.createElement("img");c.src=a.images[0],c.alt=a.name,c.style.width="36px",c.style.height="36px",c.style.objectFit="cover",c.style.borderRadius="4px",r.appendChild(c)}const s=document.createElement("span");s.textContent=`${a.name} - CA$${a.price.toFixed(2)}`,r.appendChild(s);const d=document.createElement("button");d.textContent="Remove",d.className="cart-remove-btn",d.onclick=()=>{be(i),q(),ke()},r.appendChild(d),t.appendChild(r)});let n=l.reduce((a,i)=>a+(i.price||0),0);document.getElementById("cart-total").textContent=n>0?`Total: CA$${n.toFixed(2)}`:"";const o=document.getElementById("checkout-btn");o&&(o.disabled=l.length===0,o.style.opacity=l.length===0?"0.5":"1",o.style.cursor=l.length===0?"not-allowed":"pointer")}function ke(e){const t=document.getElementById("cart-dropdown");if(t){t.style.display="block",document.addEventListener("mousedown",X);return}}function q(){const e=document.getElementById("cart-dropdown");e&&(e.style.display="none",document.removeEventListener("mousedown",X))}function X(e){const t=document.getElementById("cart-dropdown"),n=document.getElementById("cart-icon-btn");t&&!t.contains(e.target)&&n&&!n.contains(e.target)&&q()}function Y(){const e=f.front_page||{},t=f.shop||{},n=document.querySelector(".front-page");n&&(n.style.backgroundColor=e.color||"",e.image?(n.style.backgroundImage=`url('${e.image}')`,n.style.backgroundSize="cover",n.style.backgroundPosition="center"):(n.style.backgroundImage="",n.style.backgroundSize="",n.style.backgroundPosition=""));const o=document.getElementById("shop-section");o&&(o.style.backgroundColor=t.color||"",t.image?(o.style.backgroundImage=`url('${t.image}')`,o.style.backgroundSize="cover",o.style.backgroundPosition="center"):(o.style.backgroundImage="",o.style.backgroundSize="",o.style.backgroundPosition=""))}function z(){const e=document.getElementById("bg-front-color"),t=document.getElementById("bg-front-image"),n=document.getElementById("bg-shop-color"),o=document.getElementById("bg-shop-image");if(!e||!t||!n||!o)return;e.value=f.front_page?.color||"",t.value=f.front_page?.image||"",n.value=f.shop?.color||"",o.value=f.shop?.image||"";const a=document.getElementById("background-save-status");a&&(a.textContent="")}async function ve(){try{f=await g("/api/backgrounds")||f}catch{f=f||{front_page:{color:"",image:""},shop:{color:"",image:""}}}Y(),z()}async function Ce(){if(!B()){alert("Only admins can change backgrounds.");return}const e=document.getElementById("background-save-status");e&&(e.textContent="Saving...");const t={front_page:{color:(document.getElementById("bg-front-color")?.value||"").trim(),image:(document.getElementById("bg-front-image")?.value||"").trim()},shop:{color:(document.getElementById("bg-shop-color")?.value||"").trim(),image:(document.getElementById("bg-shop-image")?.value||"").trim()}};try{await g("/api/backgrounds",{method:"PUT",body:JSON.stringify(t)}),f=t,Y(),e&&(e.textContent="Saved")}catch{e&&(e.textContent="Could not save")}}function Le(e){if(!B()){alert("Only admins can change backgrounds.");return}const t=document.createElement("input");t.type="file",t.accept="image/*",t.style.display="none",t.onchange=function(){if(!t.files||!t.files[0])return;const n=new FileReader;n.onload=async function(o){const a=o.target.result||"",i={front_page:{...f.front_page},shop:{...f.shop}};i[e]=i[e]||{color:"",image:""},i[e].image=a;try{await g("/api/backgrounds",{method:"PUT",body:JSON.stringify(i)}),f=i,Y(),z();const r=document.getElementById("background-save-status");r&&(r.textContent="Saved")}catch{alert("Could not save background.")}},n.readAsDataURL(t.files[0])},document.body.appendChild(t),t.click(),document.body.removeChild(t)}async function ee(){try{p=await g("/api/bank-info")||{account_name:"",account_number:"",instructions:""},U(),M()}catch{p={account_name:"",account_number:"",instructions:""},U()}}function U(){const e=document.getElementById("bank-info-inline");e&&(p.account_number||p.instructions?e.textContent=`Pay to: ${p.account_name||""} ${p.account_number||""}`.trim():e.textContent="Owner has not set bank details yet.");const t=document.getElementById("checkout-bank-info");t&&(p.account_number||p.instructions?t.textContent=`${p.account_name||""} ${p.account_number||""} ${p.instructions||""}`.trim():t.textContent="Owner has not set bank details yet.")}function M(){const e=document.getElementById("bank-account-name"),t=document.getElementById("bank-account-number"),n=document.getElementById("bank-instructions"),o=document.getElementById("bank-info-save-status");!e||!t||!n||(y()?(e.value=p.account_name||"",t.value=p.account_number||"",n.value=p.instructions||""):(e.value="",t.value="",n.value=""),o&&(o.textContent=""))}async function Pe(){if(!y())return;const e=document.getElementById("bank-info-save-status");try{const t={account_name:document.getElementById("bank-account-name").value.trim(),account_number:document.getElementById("bank-account-number").value.trim(),instructions:document.getElementById("bank-instructions").value.trim()};await g("/api/bank-info",{method:"PUT",body:JSON.stringify(t)}),e&&(e.textContent="Saved"),await ee()}catch{e&&(e.textContent="Could not save")}}async function b(){if(y())try{C=await g("/api/orders")||[],D()}catch{C=[],D(!0)}}function D(e=!1){const t=document.getElementById("orders-list");if(t){if(e){t.innerHTML='<div class="order-card">Could not load orders.</div>';return}if(!C.length){t.innerHTML='<div class="order-card">No orders yet.</div>';return}t.innerHTML="",C.forEach(n=>{const o=document.createElement("div");o.className="order-card";const a=[n.address_line,n.city,n.region,n.postal_code].filter(Boolean).join(", "),i=xe(n.items);o.innerHTML=`
            <div><strong>${n.customer_name||"Customer"}</strong> ${n.email?"("+n.email+")":""}</div>
            <div class="order-address">${a}</div>
            <div class="order-total">Total: CA$${(Number(n.total_cents||0)/100).toFixed(2)}</div>
            <div class="order-items">Items: ${i}</div>
            <div class="order-date">${n.created_at||""}</div>
        `,t.appendChild(o)})}}function xe(e){return!e||!e.length?"None":e.map(t=>`${t.name||"Item"}${typeof t.price=="number"?" (CA$"+t.price.toFixed(2)+")":""}`).join(", ")}function Se(){if(l.length===0){alert("Your cart is empty.");return}U(),document.getElementById("checkout-error").textContent="",document.getElementById("checkout-name").value="",document.getElementById("checkout-email").value="",document.getElementById("checkout-address").value="",document.getElementById("checkout-city").value="",document.getElementById("checkout-region").value="",document.getElementById("checkout-postal").value="";const e=document.getElementById("checkout-modal");e&&(e.style.display="flex")}function Z(){const e=document.getElementById("checkout-modal");e&&(e.style.display="none")}async function Ae(){const e=document.getElementById("checkout-error"),t=document.getElementById("checkout-name").value.trim(),n=document.getElementById("checkout-email").value.trim(),o=document.getElementById("checkout-address").value.trim(),a=document.getElementById("checkout-city").value.trim(),i=document.getElementById("checkout-region").value.trim(),r=document.getElementById("checkout-postal").value.trim();if(!t||!o||!a||!r){e&&(e.textContent="Name, address, city, and postal code are required.");return}const s=l.reduce((d,c)=>d+(c.price||0),0);try{await g("/api/orders",{method:"POST",body:JSON.stringify({customer_name:t,email:n,address_line:o,city:a,region:i,postal_code:r,items:l,total:s})}),l=[],j(),$(),Z(),alert("Order placed! Follow the payment instructions to complete your purchase."),y()&&await b()}catch(d){e&&(e.textContent=d.data&&d.data.error||"Could not place order.")}}function Oe(){document.getElementById("front-page").style.display="none",document.getElementById("shop-section").style.display="";const e=localStorage.getItem("shopMessage")||"",t=document.getElementById("saved-shop-message");t&&(t.textContent=e),W()}function _e(){document.getElementById("front-page").style.display="",document.getElementById("shop-section").style.display="none",q()}function Te(){if(!B()){alert("Only admins can add products. Please log in as admin.");return}const e=document.getElementById("product-name"),t=document.getElementById("product-price"),n=document.getElementById("product-image-file"),o=e.value.trim(),a=parseFloat(t.value),i=n.files;if(!o||isNaN(a)||a<=0){alert("Please enter a valid product name and price.");return}if(i&&i.length>0){const r=[],s=[];let d=0;for(let c=0;c<i.length;c++)r[c]=new FileReader,r[c].onload=function(u){s[c]=u.target.result,d++,d===i.length&&(m.push({name:o,price:a,images:s}),O(),e.value="",t.value="",n.value="",document.getElementById("image-preview-container").innerHTML="",w())},r[c].readAsDataURL(i[c])}else m.push({name:o,price:a,images:[]}),O(),e.value="",t.value="",n.value="",document.getElementById("image-preview-container").innerHTML="",w()}function te(e,t){if(!B()){alert("Only admins can add images to products.");return}if(!t||t.length===0)return;const n=[];let o=0;const a=[];for(let i=0;i<t.length;i++)n[i]=new FileReader,n[i].onload=function(r){a[i]=r.target.result,o++,o===t.length&&(m[e].images||(m[e].images=[]),m[e].images=m[e].images.concat(a),O(),w())},n[i].readAsDataURL(t[i])}function ne(e){if(!B()){alert("Only admins can delete products.");return}confirm("Delete this product?")&&(m.splice(e,1),O(),w())}function w(){const e=document.getElementById("product-list");e.innerHTML="";const t=Fe();if(m.length===0)e.innerHTML="<li>No products yet!</li>";else if(t.length===0)e.innerHTML="<li>No products match your search.</li>";else{let n=null;t.forEach(({product:o,idx:a})=>{const i=document.createElement("li");if(i.className="product-item",i.onclick=()=>oe(a),o.images&&o.images.length>0){const d=document.createElement("div");d.className="multi-product-images",o.images.forEach(c=>{const u=document.createElement("img");u.src=c,u.alt=o.name,u.className="product-img",d.appendChild(u)}),i.appendChild(d)}const r=document.createElement("span");r.textContent=`${o.name} - CA$${o.price.toFixed(2)}`,i.appendChild(r);const s=document.createElement("button");if(s.textContent="Add to Cart",s.className="add-img-btn",s.onclick=d=>{d.stopPropagation(),Be(a)},i.appendChild(s),B()){const d=document.createElement("form");d.style.display="inline",d.onsubmit=k=>k.preventDefault();const c=document.createElement("button");c.textContent="Add Image",c.type="button",c.className="add-img-btn";const u=document.createElement("input");u.type="file",u.style.display="none",u.accept="image/*",u.multiple=!0,c.onclick=k=>{k.stopPropagation(),u.click()},u.onchange=function(){te(a,u.files),u.value=""},d.appendChild(c),d.appendChild(u),i.appendChild(d);const P=document.createElement("button");P.textContent="Delete",P.className="delete-btn",P.onclick=k=>{k.stopPropagation(),ne(a)},i.appendChild(P)}e.appendChild(i),n||(n=i)}),S&&n&&n.scrollIntoView({behavior:"smooth",block:"center"})}}function oe(e){E=e,I=0,V();const t=document.getElementById("product-modal");t&&(t.style.display="flex")}function ae(){const e=document.getElementById("product-modal");e&&(e.style.display="none"),E=null,I=0}function V(){if(E===null)return;const e=m[E];if(!e)return;const t=document.getElementById("product-modal-name"),n=document.getElementById("product-modal-price"),o=document.getElementById("product-modal-image"),a=document.getElementById("product-modal-indicator");t&&(t.textContent=e.name),n&&(n.textContent=`CA$${Number(e.price||0).toFixed(2)}`);const i=e.images&&e.images.length>0?e.images:[],r=i[I]||i[0]||"";o&&(o.src=r||"",o.alt=e.name||"Product image"),a&&(i.length<=1?a.textContent="":a.textContent=`${I+1} / ${i.length}`)}function Ne(){if(E===null)return;const e=m[E],t=e.images&&e.images.length>0?e.images:[];t.length<=1||(I=(I+1)%t.length,V())}function $e(){if(E===null)return;const e=m[E],t=e.images&&e.images.length>0?e.images:[];t.length<=1||(I=(I-1+t.length)%t.length,V())}function Me(e){S=(e||"").toLowerCase(),w()}function Fe(){return S?m.map((e,t)=>({product:e,idx:t})).filter(({product:e})=>(e.name||"").toLowerCase().includes(S)):m.map((e,t)=>({product:e,idx:t}))}const K=document.getElementById("product-image-file");K&&K.addEventListener("change",function(){const e=document.getElementById("image-preview-container");e.innerHTML="";for(let t=0;t<this.files.length;t++){const n=new FileReader;n.onload=function(o){const a=document.createElement("img");a.src=o.target.result,a.className="product-img",e.appendChild(a)},n.readAsDataURL(this.files[t])}});document.addEventListener("DOMContentLoaded",function(){document.getElementById("front-page").style.display="",document.getElementById("shop-section").style.display="none";const e=localStorage.getItem("shopMessage")||"",t=document.getElementById("saved-shop-message");t&&(t.textContent=e),W(),Q(),le(),ve(),_(),Ee(),Ie(),w(),$(),ee(),b();const n=document.getElementById("product-image-file");n&&n.addEventListener("change",function(){const o=document.getElementById("image-preview-container");o.innerHTML="";for(let a=0;a<this.files.length;a++){const i=new FileReader;i.onload=function(r){const s=document.createElement("img");s.src=r.target.result,s.className="product-img",o.appendChild(s)},i.readAsDataURL(this.files[a])}}),window.onclick=function(o){const a=document.getElementById("admin-login-modal"),i=document.getElementById("admin-panel-modal"),r=document.getElementById("product-modal"),s=document.getElementById("checkout-modal");o.target===a&&H(),o.target===i&&R(),o.target===r&&ae(),o.target===s&&Z()}});window.showAdminLogin=me;window.closeAdminLogin=H;window.adminLogin=ue;window.bootstrapOwner=pe;window.showAdminPanel=fe;window.closeAdminPanel=R;window.addAdmin=ye;window.removeAdmin=he;window.adminLogout=ge;window.saveBankInfo=Pe;window.loadOrders=b;window.startCheckout=Se;window.closeCheckout=Z;window.submitOrder=Ae;window.enterShop=Oe;window.returnToFront=_e;window.addProduct=Te;window.addImagesToProduct=te;window.deleteProduct=ne;window.handleProductSearch=Me;window.openProductDetail=oe;window.closeProductDetail=ae;window.nextProductImage=Ne;window.prevProductImage=$e;window.openBackgroundPicker=Le;window.saveBackgrounds=Ce;window.showUserAuth=de;window.userLogout=se;
