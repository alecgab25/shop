(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();let m=[],l=[],E=null,I=0,p={account_name:"",account_number:"",instructions:""},C=[],P="",f={front_page:{color:"",image:""},shop:{color:"",image:""}},k=null;const te="pk_test_ZGl2ZXJzZS1pbnNlY3QtOTAuY2xlcmsuYWNjb3VudHMuZGV2JA";let h=null,x=!1;async function g(e,t={}){const n={credentials:"include",...t};n.headers={"Content-Type":"application/json",...t.headers||{}};const o=await fetch(e,n),d=(o.headers.get("content-type")||"").includes("application/json")?await o.json().catch(()=>null):null;if(!o.ok){const s=new Error(d&&d.error||"Request failed");throw s.status=o.status,s.data=d,s}return d}function ne(e){return e?e.primaryEmailAddress&&e.primaryEmailAddress.emailAddress?e.primaryEmailAddress.emailAddress:Array.isArray(e.emailAddresses)&&e.emailAddresses.length>0&&e.emailAddresses[0].emailAddress||"":""}function O(){const e=document.getElementById("front-signout-btn");e&&(e.style.display=k?"inline-block":"none");const t=document.getElementById("front-signin-btn");t&&(t.style.display=k?"none":"inline-block")}function $(){if(!window.Clerk)return;const e=window.Clerk.user||null;k=e?{email:ne(e)||e.id}:null,k||(h=null),O()}async function oe(){if(!window.Clerk){console.error("Clerk script not loaded.");return}await window.Clerk.load({publishableKey:te}),$(),typeof window.Clerk.addListener=="function"&&window.Clerk.addListener($)}function ae(e){if(!window.Clerk){alert("Sign in is still loading. Please try again.");return}e==="signin"?window.Clerk.openSignIn():window.Clerk.openSignUp()}async function ie(){window.Clerk&&await window.Clerk.signOut(),k=null,h=null,S(),O()}async function de(){$()}function S(){const e=!!h,t=document.getElementById("admin-panel-btn");t&&(t.style.display=e?"inline-block":"none"),document.getElementById("add-product-section").style.display=e?"block":"none";const n=document.getElementById("background-section");n&&(n.style.display=e?"block":"none");const o=document.getElementById("front-bg-btn"),a=document.getElementById("shop-bg-btn");o&&(o.style.display=e?"inline-block":"none"),a&&(a.style.display=e?"inline-block":"none");const i=document.getElementById("bank-info-section");i&&(i.style.display=y()?"block":"none");const d=document.getElementById("orders-section");d&&(d.style.display=y()?"block":"none"),O()}function y(){return h&&h.is_owner}function B(){return!!h}function ce(){document.getElementById("admin-login-modal").style.display="flex",document.getElementById("admin-email-input").value="",document.getElementById("admin-password-input").value="",document.getElementById("admin-login-error").textContent="",H()}function D(){document.getElementById("admin-login-modal").style.display="none",document.getElementById("admin-password-input").value="",document.getElementById("admin-email-input").value="",document.getElementById("admin-login-error").textContent=""}async function re(){const e=document.getElementById("admin-email-input").value.trim().toLowerCase(),t=document.getElementById("admin-password-input").value,n=document.getElementById("admin-login-error");if(n.textContent="",!e||!t){n.textContent="Email and password are required.";return}try{h=await g("/api/sessions",{method:"POST",body:JSON.stringify({email:e,password:t})}),await _(),S(),w(),N(),y()&&await b(),D()}catch(o){n.textContent=o.data&&o.data.error||"Login failed."}}async function se(){try{await g("/api/sessions",{method:"DELETE"})}catch{}h=null,S(),U(),w(),N(),C=[],F()}async function le(){const e=document.getElementById("bootstrap-email").value.trim().toLowerCase(),t=document.getElementById("bootstrap-password").value,n=document.getElementById("admin-login-error");if(n.textContent="",!e||!t){n.textContent="Owner email and password are required.";return}try{await g("/api/admins/bootstrap",{method:"POST",body:JSON.stringify({email:e,password:t})}),x=!1,n.textContent="Owner created. Please log in.",document.getElementById("bootstrap-email").value="",document.getElementById("bootstrap-password").value="",H()}catch(o){n.textContent=o.data&&o.data.error||"Could not create owner."}}async function me(){if(!h){alert("You must be logged in as admin to access this panel.");return}document.getElementById("current-admin-email").textContent=h.email,await _();const e=document.querySelector(".admin-list-section");e&&(e.style.display=y()?"block":"none"),document.getElementById("admin-panel-modal").style.display="flex",document.getElementById("new-admin-email").value="",document.getElementById("new-admin-password").value="",q(),y()&&await b()}function U(){document.getElementById("admin-panel-modal").style.display="none"}async function ue(){if(!y()){alert("Only the owner can add new admins.");return}const e=document.getElementById("new-admin-email").value.trim().toLowerCase(),t=document.getElementById("new-admin-password").value;if(!e||!t){alert("Please enter email and password.");return}try{await g("/api/admins",{method:"POST",body:JSON.stringify({email:e,password:t})}),document.getElementById("new-admin-email").value="",document.getElementById("new-admin-password").value="",await _(),alert("Admin added successfully!")}catch(n){alert(n.data&&n.data.error||"Could not add admin.")}}async function ge(e){if(!y()){alert("Only the owner can remove admins.");return}if(confirm("Remove admin access?"))try{await g(`/api/admins/${e}`,{method:"DELETE"}),await _()}catch(t){alert(t.data&&t.data.error||"Could not remove admin.")}}async function _(){const e=document.getElementById("admin-list");if(e.innerHTML="",!y()){e.innerHTML="<li>Only the owner can manage admins.</li>";return}try{(await g("/api/admins")).forEach(n=>{const o=document.createElement("li");o.className="admin-list-item",o.innerHTML=`
                <span>${n.email}</span>
                ${n.is_owner?'<span class="owner-badge">Owner</span>':""}
                ${n.is_owner?"":`<button onclick="removeAdmin(${n.id})" class="remove-admin-btn">Remove</button>`}
            `,e.appendChild(o)})}catch{e.innerHTML="<li>Could not load admins.</li>"}}async function pe(){try{x=!(await g("/api/admins/has-admin")).hasAdmin}catch{x=!1}H()}function H(){const e=document.getElementById("bootstrap-section");e&&(e.style.display=x?"block":"none")}async function V(){await pe();try{h=await g("/api/session")}catch{h=null}S(),w(),N(),y()&&await b()}function fe(){const e=localStorage.getItem("products");e?m=JSON.parse(e):m=[]}function A(){localStorage.setItem("products",JSON.stringify(m))}function ye(){const e=localStorage.getItem("cart");e?l=JSON.parse(e):l=[]}function R(){localStorage.setItem("cart",JSON.stringify(l))}function he(e){l.push(m[e]),R(),T()}function we(e){l.splice(e,1),R(),T()}function T(){const e=document.getElementById("cart-count");l.length>0?(e.textContent=l.length,e.style.display="inline-block"):(e.textContent="",e.style.display="none");const t=document.getElementById("cart-list");if(!t)return;t.innerHTML="",l.length===0?t.innerHTML="<li>Cart is empty!</li>":l.forEach((a,i)=>{const d=document.createElement("li");if(a.images&&a.images[0]){const c=document.createElement("img");c.src=a.images[0],c.alt=a.name,c.style.width="36px",c.style.height="36px",c.style.objectFit="cover",c.style.borderRadius="4px",d.appendChild(c)}const s=document.createElement("span");s.textContent=`${a.name} - CA$${a.price.toFixed(2)}`,d.appendChild(s);const r=document.createElement("button");r.textContent="Remove",r.className="cart-remove-btn",r.onclick=()=>{we(i),J(),Ee()},d.appendChild(r),t.appendChild(d)});let n=l.reduce((a,i)=>a+(i.price||0),0);document.getElementById("cart-total").textContent=n>0?`Total: CA$${n.toFixed(2)}`:"";const o=document.getElementById("checkout-btn");o&&(o.disabled=l.length===0,o.style.opacity=l.length===0?"0.5":"1",o.style.cursor=l.length===0?"not-allowed":"pointer")}function Ee(e){const t=document.getElementById("cart-dropdown");if(t){t.style.display="block",document.addEventListener("mousedown",G);return}}function J(){const e=document.getElementById("cart-dropdown");e&&(e.style.display="none",document.removeEventListener("mousedown",G))}function G(e){const t=document.getElementById("cart-dropdown"),n=document.getElementById("cart-icon-btn");t&&!t.contains(e.target)&&n&&!n.contains(e.target)&&J()}function j(){const e=f.front_page||{},t=f.shop||{},n=document.querySelector(".front-page");n&&(n.style.backgroundColor=e.color||"",e.image?(n.style.backgroundImage=`url('${e.image}')`,n.style.backgroundSize="cover",n.style.backgroundPosition="center"):(n.style.backgroundImage="",n.style.backgroundSize="",n.style.backgroundPosition=""));const o=document.getElementById("shop-section");o&&(o.style.backgroundColor=t.color||"",t.image?(o.style.backgroundImage=`url('${t.image}')`,o.style.backgroundSize="cover",o.style.backgroundPosition="center"):(o.style.backgroundImage="",o.style.backgroundSize="",o.style.backgroundPosition=""))}function q(){const e=document.getElementById("bg-front-color"),t=document.getElementById("bg-front-image"),n=document.getElementById("bg-shop-color"),o=document.getElementById("bg-shop-image");if(!e||!t||!n||!o)return;e.value=f.front_page?.color||"",t.value=f.front_page?.image||"",n.value=f.shop?.color||"",o.value=f.shop?.image||"";const a=document.getElementById("background-save-status");a&&(a.textContent="")}async function Ie(){try{f=await g("/api/backgrounds")||f}catch{f=f||{front_page:{color:"",image:""},shop:{color:"",image:""}}}j(),q()}async function Be(){if(!B()){alert("Only admins can change backgrounds.");return}const e=document.getElementById("background-save-status");e&&(e.textContent="Saving...");const t={front_page:{color:(document.getElementById("bg-front-color")?.value||"").trim(),image:(document.getElementById("bg-front-image")?.value||"").trim()},shop:{color:(document.getElementById("bg-shop-color")?.value||"").trim(),image:(document.getElementById("bg-shop-image")?.value||"").trim()}};try{await g("/api/backgrounds",{method:"PUT",body:JSON.stringify(t)}),f=t,j(),e&&(e.textContent="Saved")}catch{e&&(e.textContent="Could not save")}}function be(e){if(!B()){alert("Only admins can change backgrounds.");return}const t=document.createElement("input");t.type="file",t.accept="image/*",t.style.display="none",t.onchange=function(){if(!t.files||!t.files[0])return;const n=new FileReader;n.onload=async function(o){const a=o.target.result||"",i={front_page:{...f.front_page},shop:{...f.shop}};i[e]=i[e]||{color:"",image:""},i[e].image=a;try{await g("/api/backgrounds",{method:"PUT",body:JSON.stringify(i)}),f=i,j(),q();const d=document.getElementById("background-save-status");d&&(d.textContent="Saved")}catch{alert("Could not save background.")}},n.readAsDataURL(t.files[0])},document.body.appendChild(t),t.click(),document.body.removeChild(t)}async function K(){try{p=await g("/api/bank-info")||{account_name:"",account_number:"",instructions:""},M(),N()}catch{p={account_name:"",account_number:"",instructions:""},M()}}function M(){const e=document.getElementById("bank-info-inline");e&&(p.account_number||p.instructions?e.textContent=`Pay to: ${p.account_name||""} ${p.account_number||""}`.trim():e.textContent="Owner has not set bank details yet.");const t=document.getElementById("checkout-bank-info");t&&(p.account_number||p.instructions?t.textContent=`${p.account_name||""} ${p.account_number||""} ${p.instructions||""}`.trim():t.textContent="Owner has not set bank details yet.")}function N(){const e=document.getElementById("bank-account-name"),t=document.getElementById("bank-account-number"),n=document.getElementById("bank-instructions"),o=document.getElementById("bank-info-save-status");!e||!t||!n||(y()?(e.value=p.account_name||"",t.value=p.account_number||"",n.value=p.instructions||""):(e.value="",t.value="",n.value=""),o&&(o.textContent=""))}async function ve(){if(!y())return;const e=document.getElementById("bank-info-save-status");try{const t={account_name:document.getElementById("bank-account-name").value.trim(),account_number:document.getElementById("bank-account-number").value.trim(),instructions:document.getElementById("bank-instructions").value.trim()};await g("/api/bank-info",{method:"PUT",body:JSON.stringify(t)}),e&&(e.textContent="Saved"),await K()}catch{e&&(e.textContent="Could not save")}}async function b(){if(y())try{C=await g("/api/orders")||[],F()}catch{C=[],F(!0)}}function F(e=!1){const t=document.getElementById("orders-list");if(t){if(e){t.innerHTML='<div class="order-card">Could not load orders.</div>';return}if(!C.length){t.innerHTML='<div class="order-card">No orders yet.</div>';return}t.innerHTML="",C.forEach(n=>{const o=document.createElement("div");o.className="order-card";const a=[n.address_line,n.city,n.region,n.postal_code].filter(Boolean).join(", "),i=Ce(n.items);o.innerHTML=`
            <div><strong>${n.customer_name||"Customer"}</strong> ${n.email?"("+n.email+")":""}</div>
            <div class="order-address">${a}</div>
            <div class="order-total">Total: CA$${(Number(n.total_cents||0)/100).toFixed(2)}</div>
            <div class="order-items">Items: ${i}</div>
            <div class="order-date">${n.created_at||""}</div>
        `,t.appendChild(o)})}}function Ce(e){return!e||!e.length?"None":e.map(t=>`${t.name||"Item"}${typeof t.price=="number"?" (CA$"+t.price.toFixed(2)+")":""}`).join(", ")}function ke(){if(l.length===0){alert("Your cart is empty.");return}M(),document.getElementById("checkout-error").textContent="",document.getElementById("checkout-name").value="",document.getElementById("checkout-email").value="",document.getElementById("checkout-address").value="",document.getElementById("checkout-city").value="",document.getElementById("checkout-region").value="",document.getElementById("checkout-postal").value="";const e=document.getElementById("checkout-modal");e&&(e.style.display="flex")}function Y(){const e=document.getElementById("checkout-modal");e&&(e.style.display="none")}async function Le(){const e=document.getElementById("checkout-error"),t=document.getElementById("checkout-name").value.trim(),n=document.getElementById("checkout-email").value.trim(),o=document.getElementById("checkout-address").value.trim(),a=document.getElementById("checkout-city").value.trim(),i=document.getElementById("checkout-region").value.trim(),d=document.getElementById("checkout-postal").value.trim();if(!t||!o||!a||!d){e&&(e.textContent="Name, address, city, and postal code are required.");return}const s=l.reduce((r,c)=>r+(c.price||0),0);try{await g("/api/orders",{method:"POST",body:JSON.stringify({customer_name:t,email:n,address_line:o,city:a,region:i,postal_code:d,items:l,total:s})}),l=[],R(),T(),Y(),alert("Order placed! Follow the payment instructions to complete your purchase."),y()&&await b()}catch(r){e&&(e.textContent=r.data&&r.data.error||"Could not place order.")}}function Pe(){document.getElementById("front-page").style.display="none",document.getElementById("shop-section").style.display="";const e=localStorage.getItem("shopMessage")||"",t=document.getElementById("saved-shop-message");t&&(t.textContent=e),V()}function xe(){document.getElementById("front-page").style.display="",document.getElementById("shop-section").style.display="none",J()}function Ae(){if(!B()){alert("Only admins can add products. Please log in as admin.");return}const e=document.getElementById("product-name"),t=document.getElementById("product-price"),n=document.getElementById("product-image-file"),o=e.value.trim(),a=parseFloat(t.value),i=n.files;if(!o||isNaN(a)||a<=0){alert("Please enter a valid product name and price.");return}if(i&&i.length>0){const d=[],s=[];let r=0;for(let c=0;c<i.length;c++)d[c]=new FileReader,d[c].onload=function(u){s[c]=u.target.result,r++,r===i.length&&(m.push({name:o,price:a,images:s}),A(),e.value="",t.value="",n.value="",document.getElementById("image-preview-container").innerHTML="",w())},d[c].readAsDataURL(i[c])}else m.push({name:o,price:a,images:[]}),A(),e.value="",t.value="",n.value="",document.getElementById("image-preview-container").innerHTML="",w()}function Q(e,t){if(!B()){alert("Only admins can add images to products.");return}if(!t||t.length===0)return;const n=[];let o=0;const a=[];for(let i=0;i<t.length;i++)n[i]=new FileReader,n[i].onload=function(d){a[i]=d.target.result,o++,o===t.length&&(m[e].images||(m[e].images=[]),m[e].images=m[e].images.concat(a),A(),w())},n[i].readAsDataURL(t[i])}function W(e){if(!B()){alert("Only admins can delete products.");return}confirm("Delete this product?")&&(m.splice(e,1),A(),w())}function w(){const e=document.getElementById("product-list");e.innerHTML="";const t=Te();if(m.length===0)e.innerHTML="<li>No products yet!</li>";else if(t.length===0)e.innerHTML="<li>No products match your search.</li>";else{let n=null;t.forEach(({product:o,idx:a})=>{const i=document.createElement("li");if(i.className="product-item",i.onclick=()=>X(a),o.images&&o.images.length>0){const r=document.createElement("div");r.className="multi-product-images",o.images.forEach(c=>{const u=document.createElement("img");u.src=c,u.alt=o.name,u.className="product-img",r.appendChild(u)}),i.appendChild(r)}const d=document.createElement("span");d.textContent=`${o.name} - CA$${o.price.toFixed(2)}`,i.appendChild(d);const s=document.createElement("button");if(s.textContent="Add to Cart",s.className="add-img-btn",s.onclick=r=>{r.stopPropagation(),he(a)},i.appendChild(s),B()){const r=document.createElement("form");r.style.display="inline",r.onsubmit=v=>v.preventDefault();const c=document.createElement("button");c.textContent="Add Image",c.type="button",c.className="add-img-btn";const u=document.createElement("input");u.type="file",u.style.display="none",u.accept="image/*",u.multiple=!0,c.onclick=v=>{v.stopPropagation(),u.click()},u.onchange=function(){Q(a,u.files),u.value=""},r.appendChild(c),r.appendChild(u),i.appendChild(r);const L=document.createElement("button");L.textContent="Delete",L.className="delete-btn",L.onclick=v=>{v.stopPropagation(),W(a)},i.appendChild(L)}e.appendChild(i),n||(n=i)}),P&&n&&n.scrollIntoView({behavior:"smooth",block:"center"})}}function X(e){E=e,I=0,z();const t=document.getElementById("product-modal");t&&(t.style.display="flex")}function ee(){const e=document.getElementById("product-modal");e&&(e.style.display="none"),E=null,I=0}function z(){if(E===null)return;const e=m[E];if(!e)return;const t=document.getElementById("product-modal-name"),n=document.getElementById("product-modal-price"),o=document.getElementById("product-modal-image"),a=document.getElementById("product-modal-indicator");t&&(t.textContent=e.name),n&&(n.textContent=`CA$${Number(e.price||0).toFixed(2)}`);const i=e.images&&e.images.length>0?e.images:[],d=i[I]||i[0]||"";o&&(o.src=d||"",o.alt=e.name||"Product image"),a&&(i.length<=1?a.textContent="":a.textContent=`${I+1} / ${i.length}`)}function Oe(){if(E===null)return;const e=m[E],t=e.images&&e.images.length>0?e.images:[];t.length<=1||(I=(I+1)%t.length,z())}function Se(){if(E===null)return;const e=m[E],t=e.images&&e.images.length>0?e.images:[];t.length<=1||(I=(I-1+t.length)%t.length,z())}function _e(e){P=(e||"").toLowerCase(),w()}function Te(){return P?m.map((e,t)=>({product:e,idx:t})).filter(({product:e})=>(e.name||"").toLowerCase().includes(P)):m.map((e,t)=>({product:e,idx:t}))}const Z=document.getElementById("product-image-file");Z&&Z.addEventListener("change",function(){const e=document.getElementById("image-preview-container");e.innerHTML="";for(let t=0;t<this.files.length;t++){const n=new FileReader;n.onload=function(o){const a=document.createElement("img");a.src=o.target.result,a.className="product-img",e.appendChild(a)},n.readAsDataURL(this.files[t])}});document.addEventListener("DOMContentLoaded",function(){document.getElementById("front-page").style.display="",document.getElementById("shop-section").style.display="none";const e=localStorage.getItem("shopMessage")||"",t=document.getElementById("saved-shop-message");t&&(t.textContent=e),V(),oe(),de(),Ie(),O(),fe(),ye(),w(),T(),K(),b();const n=document.getElementById("product-image-file");n&&n.addEventListener("change",function(){const o=document.getElementById("image-preview-container");o.innerHTML="";for(let a=0;a<this.files.length;a++){const i=new FileReader;i.onload=function(d){const s=document.createElement("img");s.src=d.target.result,s.className="product-img",o.appendChild(s)},i.readAsDataURL(this.files[a])}}),window.onclick=function(o){const a=document.getElementById("admin-login-modal"),i=document.getElementById("admin-panel-modal"),d=document.getElementById("product-modal"),s=document.getElementById("checkout-modal");o.target===a&&D(),o.target===i&&U(),o.target===d&&ee(),o.target===s&&Y()}});window.showAdminLogin=ce;window.closeAdminLogin=D;window.adminLogin=re;window.bootstrapOwner=le;window.showAdminPanel=me;window.closeAdminPanel=U;window.addAdmin=ue;window.removeAdmin=ge;window.adminLogout=se;window.saveBankInfo=ve;window.loadOrders=b;window.startCheckout=ke;window.closeCheckout=Y;window.submitOrder=Le;window.enterShop=Pe;window.returnToFront=xe;window.addProduct=Ae;window.addImagesToProduct=Q;window.deleteProduct=W;window.handleProductSearch=_e;window.openProductDetail=X;window.closeProductDetail=ee;window.nextProductImage=Oe;window.prevProductImage=Se;window.openBackgroundPicker=be;window.saveBackgrounds=Be;window.showUserAuth=ae;window.userLogout=ie;
